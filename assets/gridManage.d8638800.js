import{_ as B,a as O}from"./Btn.761e52cb.js";import{_ as q,c as D,b as L,d as $}from"./index.7a1cbfda.js";import{e as F,V as w,v as H,F as p,o as m,c as v,a as n,K as U,u as l,P as s,M as a,Q as y,J as I,a1 as x,L as C,R as j,ar as R,as as N}from"./@vue.bf949a70.js";import{g as P,p as A,a as J,b as K}from"./request.c8d86fd1.js";import{E as Q}from"./element-plus.04a089c1.js";import"./vue-router.8e65bb6b.js";import"./jquery.310f556f.js";import"./axios.1257cc19.js";import"./pinia.c6d8a7dc.js";import"./vue-demi.b3a9cad9.js";import"./lodash.ab0557e0.js";/* empty css                    */import"./dayjs.af8763dd.js";import"./lodash-es.5d194466.js";import"./@vueuse.842cb5bc.js";import"./@element-plus.2727cb8c.js";import"./async-validator.5d25c98b.js";import"./@popperjs.7a88ba6a.js";import"./@ctrl.2e36ce53.js";import"./qs.cbfe7bae.js";import"./side-channel.ed271cce.js";import"./get-intrinsic.1675b33e.js";import"./has-symbols.caae0f97.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.0b5a4f26.js";import"./object-inspect.5a656981.js";const d=u=>(R("data-v-71bd78db"),u=u(),N(),u),W={class:"gridManage darkcolor"},X={class:"flex column col-12 card",style:{height:"100%"}},Y={class:"top-p-40 flex align-c"},Z={class:"fl getRoleBtn"},ee={class:"flex align-c just-b wrap top2"},te={class:"fr cursor condition flex align-c"},ie=d(()=>n("span",{style:{"margin-right":"5px"}},"\u533A\u57DF:",-1)),le={class:"col-auto",style:{padding:"0",height:"calc(100% - 140px)"}},oe=d(()=>n("div",{class:"flex just-c align-c omit",style:{flex:"0 0 120px"}},"\u7F16\u8F91",-1)),ne={class:"flex just-a align-c",style:{flex:"0 0 120px"}},se=["onClick"],re={class:"select condition"},ae={class:"col-6",style:{"padding-right":"10px"}},de=d(()=>n("p",{class:"top-p-30"},[n("span",{class:"select condition"},"\u57FA\u672C\u4FE1\u606F")],-1)),ce=d(()=>n("label",null,"\u5168\u540D",-1)),fe=d(()=>n("label",null,"\u522B\u540D",-1)),pe=d(()=>n("label",null,"\u533A\u57DF\u7B49\u7EA7",-1)),me=d(()=>n("label",null,"\u63CF\u8FF0",-1)),ue={class:"col-6"},ge=d(()=>n("p",{class:"top-p-30"},[n("span",{class:"select condition"},"\u4E0A\u7EA7\u533A\u57DF")],-1)),he={class:"col-12"},_e=d(()=>n("p",{class:"top-p-30"},[n("span",{class:"select condition"},"\u533A\u57DF\u89C4\u5212")],-1)),ve=d(()=>n("label",null,"\u4E2D\u5FC3\u70B9",-1)),ye={setup(u){const g=F(null),c=w({pointMap:!1,point:"",backPoint(i){c.pointMap=!1,e.mapPoint.checkId.toString()===""?e.info.form.centrePoint=i:(e.mapPoint.checkId.toString()==="rectangle"||e.mapPoint.checkId.toString()==="polyline")&&(e.info.form.centrePoint=i.point,e.info.form.boundary=i.boundary)}}),e=w({level:[{name:"\u7B2C\u4E00\u7EA7\u533A\u57DF",id:1},{name:"\u7B2C\u4E8C\u7EA7\u533A\u57DF",id:2},{name:"\u7B2C\u4E09\u7EA7\u533A\u57DF",id:3}],handleLevel(){e.info.form.parentId="",e.gridTree.checkId=[],e.gridTree.checkLevel=e.info.form.level-1},filterGrid(i){i=i.filter(t=>e.info.form.id!==t.id?(t.children&&t.children.length>0&&e.filterGrid(t.children),!0):!1),e.gridTree.list=i},menus:[],roleMenusInfo:{name:"",list:[],checkId:[],key:"name",value:"id",child:"child",column:!0,single:!1},tree:[],list:{name:"role",header:[{name:"\u533A\u57DF\u540D",width:"100px",key:"name",color:"#9495a9"},{name:"\u522B\u540D",width:"100px",key:"alias",color:"#9495a9"},{name:"\u533A\u57DF\u7B49\u7EA7",width:"100px",key:"level",color:"#9495a9",select:["","\u7B2C\u4E00\u7EA7\u533A\u57DF","\u7B2C\u4E8C\u7EA7\u533A\u57DF","\u7B2C\u4E09\u7EA7\u533A\u57DF"]},{name:"\u4E2D\u5FC3\u70B9",width:"180px",key:"centrePoint",color:""},{name:"\u63CF\u8FF0",width:"100px",key:"description",color:"#9495a9"},{name:"\u521B\u5EFA\u65F6\u95F4",width:"180px",key:"createTime",color:"",rang:!0}],rows:[],page:1,size:20,total:100,currentPage:1,act:0,select:{open:!0,selectAll:!1,isIndeterminate:!1,selectId:[]},time:[new Date(new Date().getTime()-7*24*60*60*1e3),new Date],station:null,stationArr:[],grid:null,gridArr:[],type:0,num1:0,num2:2e3,params:["PM10"],paramsArr:["PM10","PM25","NO2","SO2","CO","CO2","O3","VOC"]},mapPoint:{name:"mapPoint",list:[{name:"\u9ED8\u8BA4\u5212\u5206 \u53EA\u6807\u8BB0\u4E00\u4E2A\u4E2D\u5FC3\u70B9\u89C6\u4E3A\u533A\u57DF\u533A\u57DF",id:""},{name:"\u81EA\u5B9A\u5212\u5206 \u7528\u5355\u4F4D\u8DDD\u79BB\u7684\u6B63\u65B9\u5F62\u6765\u5212\u5206\u533A\u57DF\uFF0C\u6BCF\u4E2A\u77E9\u5F62\u4EE3\u8868\u4E00\u4E2A\u533A\u57DF",id:"rectangle"},{name:"\u81EA\u5B9A\u5212\u5206 \u81EA\u5DF1\u5B9A\u4E49\u533A\u57DF\u7684\u533A\u57DF\uFF0C\u81EA\u5DF1\u5B9A\u4E49\u4E2D\u5FC3\u70B9\u4F4D\u7F6E",id:"polyline"}],checkId:[""],key:"name",value:"id",child:"children",column:!0,column2:!0,single:!0},checkIdPoint(i){console.log(i,"val")},gridTree:{name:"tree",list:[],list2:[],checkId:[],checkLevel:null,checkLevelOpen:!0,key:"name",value:"id",child:"children2",column:!0,column2:!0,single:!0},checkIdGrid(i){e.info.form.parentId=i.checkId.toString()},handleCurrentChange(i){e.list.select.selectId=[],e.list.select.selectAll=!1,e.list.page=i.page,e.getGrid()},typechange(i){e.list.type=i,this.list.act?this.getEnvironment():this.getGrid()},paramschange(i){const t=e.list.params.indexOf(i);t!==-1?e.list.params.splice(t,1):e.list.params.push(i)},getTreeData(i,t){t==="init"?i.forEach(r=>{this.list.gridArr.push(r),r.children&&r.children.length>0&&this.getTreeData(r.children,t)}):i.forEach(r=>{r.id===t&&r.stations&&(this.list.stationArr=this.list.stationArr.concat(r.stations)),r.children&&r.children.length>0&&this.getTreeData(r.children,t)})},async getSelect(){let i=await P("/users/grid/tree");i.code===200&&(this.gridTree.list=i.data,this.gridTree.list2=i.data)},falgG:!0,handleGridAll(i){e.falgG?(e.list.grid=["-1"],e.list.rows=e.list.gridArr,e.list.rows.forEach(t=>{e.list.grid.push(t.id),t.children2=t.children?t.children:t.children2,t.children=null}),e.list.total=e.list.gridArr.length):(e.list.grid=[],e.list.stationArr=[],e.list.rows=[],e.list.total=0,e.list.station=[]),i&&(e.falgG=!e.falgG)},handleGrid(){if(e.list.grid.includes("-1")&&e.list.grid.length===e.list.gridArr.length){let t=e.list.grid.indexOf("-1");t!=="-1"&&e.list.grid.splice(t,1),e.falgG=!0}else!e.list.grid.includes("-1")&&e.list.grid.length===e.list.gridArr.length&&(e.list.grid.push("-1"),e.falgG=!1);let i=[];e.list.gridArr.forEach(t=>{e.list.grid.includes(t.id)&&(t.children=null,i.push(t))}),e.list.rows=_.clone(i),e.list.total=e.list.gridArr.length},falgS:!0,handleStationAll(){e.falgS?(e.list.station=["-1"],e.list.stationArr.forEach(i=>{e.list.station.push(i.id)}),e.list.rows=e.list.stationArr,e.list.total=e.list.stationArr.length):(e.list.station=[],e.list.rows=[],e.list.total=0),e.falgS=!e.falgS},handleStation(){if(e.list.station.includes("-1")&&e.list.station.length===e.list.stationArr.length){let i=e.list.station.indexOf("-1");i!=="-1"&&e.list.station.splice(i,1),e.falgS=!0}else!e.list.station.includes("-1")&&e.list.station.length===e.list.stationArr.length&&(e.list.station.push("-1"),e.falgS=!1);e.list.rows=e.list.stationArr.filter(i=>e.list.station.includes(i.id)),e.list.total=e.list.stationArr.filter(i=>e.list.station.includes(i.id)).length},async getGrid(){this.list.act=0;let i=await P("/users/grid/tree");i.code===200&&(this.gridTree.list=i.data,this.gridTree.list2=i.data,this.list.gridArr=[],this.tree=_.clone(i.data),this.getTreeData(_.clone(i.data),"init"),this.handleGridAll())},async getEnvironment(){this.list.act=1;let i=await A("/roleuser/showUser");i.code===200&&(this.list.rows=i.data.rows,this.list.total=i.data.total)},info:{show:!1,name:"historyPop",w:"50%",form:{id:"",organizationId:"",parentId:"",level:"",name:"",alias:"",description:"",centrePoint:"",boundary:"",createTime:""},formRules:{organizationId:[{required:!0,message:"\u8BF7\u8F93\u5165...\uFF01",trigger:"change"}],level:[{required:!0,message:"\u8BF7\u9009\u62E9\u533A\u57DF\u7B49\u7EA7\uFF01",trigger:"change"}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u533A\u57DF\u540D\uFF01",trigger:"change"}],alias:[{required:!0,message:"\u8BF7\u8F93\u5165\u533A\u57DF\u522B\u540D\uFF01",trigger:"change"}],description:[{required:!0,message:"\u8BF7\u586B\u5199\u63CF\u8FF0\uFF01",trigger:"change"}],centrePoint:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E2D\u5FC3\u70B9\uFF01",trigger:"change"}],boundary:[{required:!0,message:"\u8BF7\u9009\u62E9\u533A\u57DF\u8303\u56F4\uFF01",trigger:"change"}],parentId:[{required:!0,validator:(i,t,r)=>{e.info.form.level===1?r():t===""?r(new Error("\u8BF7\u9009\u62E9\u4E0A\u7EA7\u533A\u57DF\uFF01\u82E5\u65E0\u53EF\u9009\u9879\u8BF7\u5148\u521B\u5EFA\u5F53\u524D\u6240\u9009\u533A\u57DF\u7B49\u7EA7\u7684\u4E0A\u7EA7\u533A\u57DF\uFF01")):r()},trigger:"blur"}]},type:"add"},getInfo(){},show(i,t){g.value.resetFields(),this.info.show=!0,this.info.type=i.type,this.info.type==="edit"?(this.info.form=_.clone(t),this.info.form.parentId?this.gridTree.checkId=[this.info.form.parentId]:this.gridTree.checkId=[this.info.form.id],c.point=e.info.form.centrePoint):(c.point="0,0",e.info.form={id:"",organizationId:"",parentId:"",level:"",name:"",alias:"",description:"",centrePoint:"",boundary:"",createTime:""}),e.filterGrid(e.gridTree.list),e.gridTree.checkLevel=e.info.form.level-1},hide(){this.info.show=!1,this.gridTree.checkId=[],g.value.resetFields(),e.gridTree.list=e.gridTree.list2},edit(){g.value.validate(async i=>{if(i)e.info.form.level===1&&(e.info.form.parentId=""),e.info.type==="add"?(e.info.form.createTime=null,e.info.form.id=null,e.info.form.organizationId=null,(await A("/users/grid",e.info.form,!0)).code===200&&(this.info.show=!1,this.info.type="add",this.getGrid())):e.info.type==="edit"&&(await J("/users/grid",e.info.form,!0)).code===200&&(this.info.show=!1,this.info.type="add",this.getGrid());else return console.log("\u4E0D\u901A\u8FC7"),!1})},async del(i){let t=await K(`/users/grid/${i.id}`);t.code===200&&(this.getGrid(),i.visible=!1,Q({duration:1e3,type:"success",message:t.msg}))}});return H(()=>{e.getGrid()}),(i,t)=>{const r=p("el-option"),k=p("el-select"),T=B,G=p("el-popconfirm"),V=D,h=p("el-input"),f=p("el-form-item"),b=L,S=p("el-form"),M=$,z=O;return m(),v("div",W,[n("div",X,[n("p",Y,[n("span",Z,[n("span",{class:U([l(e).list.act===0?"select":"","cursor"]),onClick:t[0]||(t[0]=(...o)=>l(e).getGrid&&l(e).getGrid(...o))},"\u533A\u57DF\u7BA1\u7406",2)])]),n("p",ee,[n("span",te,[ie,s(k,{modelValue:l(e).list.grid,"onUpdate:modelValue":t[2]||(t[2]=o=>l(e).list.grid=o),clearable:"","collapse-tags":"",filterable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u533A\u57DF",style:{width:"200px"},onChange:l(e).handleGrid},{default:a(()=>[s(r,{label:"\u5168\u9009",value:"-1",onClick:t[1]||(t[1]=y(o=>l(e).handleGridAll(1),["stop"]))}),(m(!0),v(I,null,x(l(e).list.gridArr,o=>(m(),C(r,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),s(T,{info:{id:3,name:"",type:"add",class:"Btn fr",icon:"icon-zengjia",title:"\u65B0\u589E"},onHandleClick:t[3]||(t[3]=o=>l(e).show({type:"add"}))})]),n("div",le,[s(V,{list:l(e).list,onHandleCurrentChange:l(e).handleCurrentChange},{rightTitle:a(()=>[oe]),rightBtn:a(({item:o})=>[n("div",ne,[n("i",{class:"iconfont iconfontHover icon-bianji1",title:"\u7F16\u8F91",onClick:E=>l(e).show({type:"edit"},o)},null,8,se),s(G,{title:"\u60A8\u662F\u5426\u786E\u5B9A\u5220\u9664\u5F53\u524D\u533A\u57DF?",onCancel:t[5]||(t[5]=()=>{}),onConfirm:y(E=>l(e).del(o),["stop"])},{reference:a(()=>[n("i",{class:"iconfont iconfontHover icon-shanchu_o",title:"\u5220\u9664",onClick:t[4]||(t[4]=y(()=>{},["stop"]))})]),_:2},1032,["onConfirm"])])]),_:1},8,["list","onHandleCurrentChange"])])]),s(M,{info:l(e).info,onHide:t[13]||(t[13]=o=>l(e).hide())},{title:a(()=>[n("span",re,j(l(e).info.type==="edit"?"\u7F16\u8F91":"\u6DFB\u52A0"),1)]),main:a(()=>[s(S,{ref_key:"gridForm",ref:g,model:l(e).info.form,rules:l(e).info.formRules,class:"gridForm padding-10",size:"mini"},{default:a(()=>[n("div",ae,[de,s(f,{class:"label",label:"",prop:"name"},{default:a(()=>[ce,s(h,{modelValue:l(e).info.form.name,"onUpdate:modelValue":t[6]||(t[6]=o=>l(e).info.form.name=o),autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165...",size:"small"},null,8,["modelValue"])]),_:1}),s(f,{class:"label",label:"",prop:"alias"},{default:a(()=>[fe,s(h,{modelValue:l(e).info.form.alias,"onUpdate:modelValue":t[7]||(t[7]=o=>l(e).info.form.alias=o),autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165...",size:"small"},null,8,["modelValue"])]),_:1}),s(f,{class:"label",label:"",prop:"level"},{default:a(()=>[pe,s(k,{modelValue:l(e).info.form.level,"onUpdate:modelValue":t[8]||(t[8]=o=>l(e).info.form.level=o),filterable:"",placeholder:"\u8BF7\u9009\u62E9...",size:"small",style:{width:"100%"},onChange:l(e).handleLevel},{default:a(()=>[(m(!0),v(I,null,x(l(e).level,o=>(m(),C(r,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),s(f,{class:"label",label:"",prop:"description"},{default:a(()=>[me,s(h,{modelValue:l(e).info.form.description,"onUpdate:modelValue":t[9]||(t[9]=o=>l(e).info.form.description=o),autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165...",size:"small",type:"textarea"},null,8,["modelValue"])]),_:1})]),n("div",ue,[ge,s(f,{class:"label",label:"",prop:"parentId"},{default:a(()=>[s(b,{data:l(e).gridTree,onCheckId:l(e).checkIdGrid},null,8,["data","onCheckId"])]),_:1})]),n("div",he,[_e,s(b,{data:l(e).mapPoint,onCheckId:l(e).checkIdPoint},null,8,["data","onCheckId"]),s(f,{class:"label",label:"",prop:"centrePoint"},{default:a(()=>[ve,s(h,{modelValue:l(e).info.form.centrePoint,"onUpdate:modelValue":t[11]||(t[11]=o=>l(e).info.form.centrePoint=o),disabled:!0,autocomplete:"off",size:"small"},{suffix:a(()=>[n("i",{class:"iconfont rightIcon icon-dingwei cursor iconfontHover",onClick:t[10]||(t[10]=o=>l(c).pointMap=!0)})]),_:1},8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"])]),page:a(()=>[n("span",{class:"confirm_btn cursor",onClick:t[12]||(t[12]=o=>l(e).edit())},"\u786E\u5B9A")]),_:1},8,["info"]),s(z,{data:{show:l(c).pointMap,point:l(c).point,type:l(e).mapPoint.checkId.toString(),line:l(e).info.form.boundary},onBackPoint:l(c).backPoint},null,8,["data","onBackPoint"])])}}};var Je=q(ye,[["__scopeId","data-v-71bd78db"]]);export{Je as default};
