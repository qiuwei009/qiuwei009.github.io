import{b as T}from"./axios.1257cc19.js";import{l as u}from"./qs.cbfe7bae.js";import{u as k}from"./index.7a1cbfda.js";import{E as n,a as p,K as x}from"./element-plus.04a089c1.js";const c=k();let L="http://119.3.27.196:8000",y=new Date().getTime(),b=new Date().getTime(),g=null,w,l=0;const m=T.create({baseURL:L,timeout:15e3});m.interceptors.request.use(e=>{e.method==="get"&&(e.data=!0);let a=JSON.parse(window.sessionStorage.getItem("gy_token"))||"";return a&&(e.headers.Authorization=a),e},e=>(console.log(e,"\u8BF7\u6C42\u62E6\u622A\u5668error"),Promise.reject(e)));m.interceptors.response.use(e=>{switch(y=new Date().getTime(),y-b>2e3||y-b===0?(b=new Date().getTime(),g=setTimeout(()=>{c.setLoading(!1)},500)):(g&&clearTimeout(g),g=setTimeout(()=>{c.setLoading(!1)},1e3)),e.data.code){case 400:e.data.message="\u8BF7\u6C42\u9519\u8BEF(400)",n({duration:1e3,type:"error",message:e.data.msg});break;case 401:l++,l===1&&p.confirm("\u60A8\u7684\u767B\u5F55\u9A8C\u8BC1\u5DF2\u5931\u6548,\u4E3A\u4FDD\u8BC1\u5B89\u5168,\u8BF7\u91CD\u65B0\u767B\u5F55!","\u767B\u5F55\u9A8C\u8BC1\u5DF2\u5931\u6548\u672A\u6388\u6743(401)",{confirmButtonText:"\u9000\u51FA",cancelButtonText:"\u53D6\u6D88",type:"success"}).then(()=>{location.href="/login"}).catch(()=>{location.href="/login"});break;case 403:e.data.message="\u62D2\u7EDD\u8BBF\u95EE(403)",n({duration:1e3,type:"error",message:e.data.msg});break;case 404:e.data.message="\u8BF7\u6C42\u51FA\u9519(404)",n({duration:1e3,type:"error",message:e.data.msg});break;case 408:e.data.message="\u8BF7\u6C42\u8D85\u65F6(408)",n({duration:1e3,type:"error",message:e.data.msg});break;case 500:e.data.message="\u670D\u52A1\u5668\u9519\u8BEF(500)",n({duration:1e3,type:"error",message:e.data.msg});break;case 501:e.data.message="\u670D\u52A1\u672A\u5B9E\u73B0(501)",n({duration:1e3,type:"error",message:e.data.msg});break;case 502:e.data.message="\u7F51\u7EDC\u9519\u8BEF(502)",n({duration:1e3,type:"error",message:e.data.msg});break;case 503:e.data.message="\u670D\u52A1\u4E0D\u53EF\u7528(503)",n({duration:1e3,type:"error",message:e.data.msg});break;case 504:e.data.message="\u7F51\u7EDC\u8D85\u65F6(504)",n({duration:1e3,type:"error",message:e.data.msg});break;case 505:e.data.message="HTTP\u7248\u672C\u4E0D\u53D7\u652F\u6301(505)",n({duration:1e3,type:"error",message:e.data.msg});break}return e},e=>(console.log(e,"\u54CD\u5E94\u62E6\u622A\u5668error"),l++,l===1&&p.confirm("\u60A8\u7684\u767B\u5F55\u9A8C\u8BC1\u5DF2\u5931\u6548,\u4E3A\u4FDD\u8BC1\u5B89\u5168,\u8BF7\u91CD\u65B0\u767B\u5F55!","\u767B\u5F55\u9A8C\u8BC1\u5DF2\u5931\u6548\u672A\u6388\u6743(401)",{confirmButtonText:"\u9000\u51FA",cancelButtonText:"\u53D6\u6D88",type:"success"}).then(()=>{location.href="/login"}).catch(()=>{location.href="/login"}),c.setLoading(!1),Promise.reject(e)));const f={"Content-Type":"application/json"},h={"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},D=(e,a={},o=!1,r=!0)=>new Promise((d,s)=>{r&&c.setLoading(!0),m.post(e,o?JSON.stringify(a):u.stringify(a),{headers:o?f:h}).then(t=>{d(t.data)}).catch(t=>{s(t.data)})}),J=(e,a={},o=!1,r=!0)=>new Promise((d,s)=>{r&&c.setLoading(!0),m.get(e,o?JSON.stringify(a):{params:a},{headers:o?f:h}).then(t=>{d(t.data)}).catch(t=>{s(t.data)})}),N=(e,a={},o=!1,r=!0)=>new Promise((d,s)=>{r&&c.setLoading(!0),m.put(e,o?JSON.stringify(a):u.stringify(a),{headers:o?f:h}).then(t=>{d(t.data)}).catch(t=>{s(t.data)})}),B=(e,a={},o=!1,r=!0)=>new Promise((d,s)=>{r&&c.setLoading(!0),m.delete(e,o?{params:a}:u.stringify(a),{headers:o?f:h}).then(t=>{d(t.data)}).catch(t=>{s(t.data)})}),E=(e,a,o)=>(w=x.service({text:"\u6B63\u5728\u4E0B\u8F7D\u6570\u636E\uFF0C\u8BF7\u7A0D\u5019",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),m.post(e,a,{transformRequest:[r=>u.stringify(r)],headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}).then(async r=>{try{const d=r.data,s=new FileReader;s.readAsDataURL(d),s.onload=t=>{const i=document.createElement("a");console.log(r.headers,"res.headers"),i.download=o,i.href=t.target.result,document.body.appendChild(i),i.click(),document.body.removeChild(i)}}catch{const s=await data.text(),t=JSON.parse(s),i=errorCode[t.code]||t.msg||errorCode.default;n.error(i)}setTimeout(()=>{w.close()},200)}).catch(r=>{console.error(r),n.error("\u4E0B\u8F7D\u6587\u4EF6\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\uFF01"),setTimeout(()=>{w.close()},200)}));export{N as a,B as b,E as d,J as g,D as p};
